<?php
if (!defined('ABSPATH')) exit;
function ufsc_send_email($to,$subject,$message){ wp_mail($to,$subject,$message,array('Content-Type: text/html; charset=UTF-8')); }
function ufsc_email_template($title,$body){ return '<div style="font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:16px;background:#f8fafc;"><div style="max-width:640px;margin:0 auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;"><div style="padding:14px 18px;border-bottom:1px solid #eef2f7;"><h2 style="margin:0;font-size:18px;">'.$title.'</h2></div><div style="padding:18px">'.$body.'</div><div style="padding:12px 18px;border-top:1px solid #eef2f7;font-size:12px;color:#64748b;">UFSC — Gestion de Club</div></div></div>'; }
add_action('woocommerce_order_status_changed', function($order_id,$from,$to,$order){ if(!in_array($to,array('processing','completed'),true)) return; $user=wp_get_current_user(); $to=$user&&$user->exists()?$user->user_email:get_option('admin_email'); $subject=__('Paiement reçu — Licence validée','plugin-ufsc-gestion-club-13072025'); $body=__('Votre commande a été payée. La licence liée est passée à l\'état Validée.','plugin-ufsc-gestion-club-13072025'); ufsc_send_email($to,$subject,ufsc_email_template($subject,'<p>'.$body.'</p><p>#Commande: '.$order_id.'</p>')); },30,4);
